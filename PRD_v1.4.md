# UDP协议解析器 PRD

## 1. 产品概述

产品名称：跨平台桌面UDP协议解析器  
版本：1.4  
描述：这是一个桌面应用程序，用于解析UDP协议数据，支持自定义规则、枚举，并将16进制输入解析为中文可读格式。支持跨平台运行（Windows、macOS、Linux）。

## 2. 目标和范围

### 2.1 产品目标
- 提供一个用户友好的工具，帮助开发者、网络工程师或安全研究人员快速解析UDP数据包。
- 支持灵活的规则管理，以适应不同UDP协议变体。
- 确保解析结果及用户界面完全以中文呈现，便于中文用户理解。

### 2.2 范围
- 在范围：UDP数据解析、规则编辑、枚举管理、导入/导出功能、UDP数据发送和接收解析、样本数据生成与管理。
- 不在范围：其他协议（如TCP）的解析、云端集成。

## 3. 用户需求和用例

### 3.1 目标用户
- 软件开发者：用于调试UDP-based应用。
- 网络工程师：分析网络流量。
- 安全研究人员：检查UDP数据包内容。

### 3.2 主要用例
1. **解析UDP数据**：用户输入16进制字节字符串，应用根据规则解析并显示中文描述。
2. **管理规则**：添加新规则、复制现有规则、修改规则、建立枚举映射。
3. **规则共享**：导入/导出规则文件，便于团队协作。
4. **样本管理**：生成、保存和加载协议的样本数据，便于快速测试。

## 4. 功能规格

### 4.1 规则管理
- **添加规则**：用户可以通过UI界面定义新规则，包括字段名称、数据类型（e.g., int, string, array）、长度、偏移、关联枚举、指定解析算法（e.g., LongToIp, BCD, UTF8等）。
- **复制规则**：支持一键复制现有规则，自动生成新名称（如 "Name (Copy)"）并重置内部ID，便于基于现有协议快速创建变体。
- **条件字段**：支持根据字段长度动态解析为不同名称和枚举。
- **修改规则**：编辑现有规则，支持搜索和批量修改。
- **导入规则**：从JSON、XML或自定义格式文件导入规则。
- **导出规则**：将规则导出为文件，支持多种格式。

### 4.2 枚举建立
- 用户可以创建枚举字典，将数值映射到中文描述（e.g., 0x01 -> "连接成功"）。
- 支持在规则中选择特定枚举进行关联。
- 支持添加、编辑、删除枚举项。

### 4.3 数据输入和解析
- **输入工具栏**：提供便捷的操作按钮：
    - **复制**：将输入框中的内容复制到剪贴板。
    - **保存示例**：将当前输入框的内容保存为当前选中规则的默认示例（需确认）。
    - **格式化**：手动格式化输入的Hex字符串。
    - **清空**：清空输入框内容。
- **输入**：文本框输入HexDump风格的16进制字符串（e.g., "45 00 00 1c..."），支持自动去除空格解析。
- **知名协议解析**：除了基于偏移的自定义规则解析外，支持内置的知名UDP应用层协议（如 STUN, SIP, DNS, DHCP 等）的自动识别与解析。
- **生成码流（样本生成）**：
    - 用户可以通过弹窗表单输入各字段值（支持数字字段自动聚焦选中）。
    - **枚举支持**：若字段关联了枚举，提供下拉框自动匹配选择，无需手动输入数值。
    - **数组支持**：若字段为数组类型，支持使用分号（;）分隔输入多个元素（如 "192.168.1.1; 10.0.0.1"）。
    - 系统根据规则自动生成HexDump风格的16进制码流并填充至输入框。
- **解析**：应用根据加载的规则解析数据，输出结构化结果，如字段名和中文值。
- **输出**：表格或树状视图显示解析结果，支持展开/折叠。UI需保证输入区与结果区顶部对齐。

### 4.4 UDP发送和接收
- **发送**：生成码流后，用户可以指定UDP服务器（IP和端口）发送数据。
- **接收**：支持监听指定UDP端口，接收数据并根据选定规则自动解析，显示结果。
- **模版管理**：
    - 独立的模版管理页签，允许用户创建、编辑、保存常用的数据包模版。
    - 支持关联协议规则，自动生成输入表单。
    - **双列布局**：模版编辑表单采用双列网格布局，一行显示两个字段，节省屏幕空间。
    - **导入/导出**：支持模版数据的导入和导出，同时包含自动回复规则。
- **自动响应**：
    - 独立的自动回复管理页签。
    - 配置响应规则：当接收到的消息满足特定条件（协议+字段+值）时，自动回复指定的模版消息。
    - **多重响应动作**：支持配置多个响应动作，每个动作可单独设置响应模版和延迟时间（毫秒），实现复杂交互模拟（如：收到请求 -> 延迟100ms回复A -> 延迟500ms回复B）。
    - 支持启用/禁用规则。
- **知名协议模拟**：针对知名协议（如 STUN, SIP），提供预置的模拟响应逻辑。

### 4.5 用户界面
- **导航栏**：左侧侧边栏导航，支持折叠/展开以节省屏幕空间。
- **本地化**：全中文界面，无英文残留。
- **主界面**：输入区、规则编辑区、输出区、发送/接收配置区。
- **对齐**：输入区标题栏与结果区标题栏高度一致，确保视觉整齐。
- 支持主题切换、搜索功能。

## 5. 非功能需求

- **跨平台**：兼容Windows、macOS、Linux。
- **性能**：解析时间 < 1秒 for 1KB数据。
- **可用性**：直观UI，支持中文界面，便捷的样本生成与管理体验。
- **安全性**：不存储敏感数据，本地运行。
- **可扩展性**：规则系统易于扩展。

## 6. 技术栈建议
- **框架**：Electron（跨平台桌面应用）。
- **前端**：React.js 或 Vue.js，用于UI。
- **后端**：Node.js，用于解析逻辑。
- **存储**：本地JSON文件存储规则。
- **其他**：使用Buffer处理16进制数据；使用dgram模块处理UDP发送和接收；实现各种解析算法如LongToIp、BCD、UTF8等。

## 7. 风险和假设
- **风险**：复杂UDP协议的解析准确性需测试；UDP发送/接收的网络权限和兼容性。
