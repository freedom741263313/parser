# UDP协议解析器 PRD

## 1. 产品概述

产品名称：跨平台桌面UDP协议解析器  
版本：1.0  
描述：这是一个桌面应用程序，用于解析UDP协议数据，支持自定义规则、枚举，并将16进制输入解析为中文可读格式。支持跨平台运行（Windows、macOS、Linux）。

## 2. 目标和范围

### 2.1 产品目标
- 提供一个用户友好的工具，帮助开发者、网络工程师或安全研究人员快速解析UDP数据包。
- 支持灵活的规则管理，以适应不同UDP协议变体。
- 确保解析结果以中文呈现，便于中文用户理解。

### 2.2 范围
- 在范围：UDP数据解析、规则编辑、枚举管理、导入/导出功能、UDP数据发送和接收解析。
- 不在范围：其他协议（如TCP）的解析、云端集成。

## 3. 用户需求和用例

### 3.1 目标用户
- 软件开发者：用于调试UDP-based应用。
- 网络工程师：分析网络流量。
- 安全研究人员：检查UDP数据包内容。

### 3.2 主要用例
1. **解析UDP数据**：用户输入16进制字节字符串，应用根据规则解析并显示中文描述。
2. **管理规则**：添加新规则、修改现有规则、建立枚举映射。
3. **规则共享**：导入/导出规则文件，便于团队协作。

## 4. 功能规格

### 4.1 规则管理
- **添加规则**：用户可以通过UI界面定义新规则，包括字段名称、数据类型（e.g., int, string）、长度、偏移、关联枚举、指定解析算法（e.g., LongToIp, BCD, UTF8等）。
- **条件字段**：支持根据字段长度动态解析为不同名称和枚举（e.g., 长度为4时解析为IP地址，长度为2时解析为端口）。
- **修改规则**：编辑现有规则，支持搜索和批量修改。
- **导入规则**：从JSON、XML或自定义格式文件导入规则。
- **导出规则**：将规则导出为文件，支持多种格式。

### 4.2 枚举建立
- 用户可以创建枚举字典，将数值映射到中文描述（e.g., 0x01 -> "连接成功"）。
- 支持在规则中选择特定枚举进行关联。
- 支持添加、编辑、删除枚举项。

### 4.3 数据输入和解析
- **输入**：文本框输入HexDump风格的16进制字符串（e.g., "45 00 00 1c 00 01 00 00 40 11 00 00 c0 a8 01 01 c0 a8 01 02"），支持自动去除空格解析。
- **知名协议解析**：除了基于偏移的自定义规则解析外，支持内置的知名UDP应用层协议（如 STUN, SIP, DNS, DHCP 等）的自动识别与解析。
- **生成码流**：用户可以选择协议规则，生成HexDump风格的16进制码流。
- **解析**：应用根据加载的规则解析数据，输出结构化结果，如字段名和中文值。
- **输出**：树状视图或表格显示解析结果，支持展开/折叠。

### 4.4 UDP发送和接收
- **发送**：生成码流后，用户可以指定UDP服务器（IP和端口）发送数据。
- **接收**：支持监听指定UDP端口，接收数据并根据选定规则自动解析，显示结果。
- **自动响应**：在接收消息后，根据消息中指定字段的值，配置响应规则：使用系统内添加的规则设置值生成响应流并发送，或选择不响应。
- **知名协议模拟**：针对知名协议（如 STUN, SIP），提供预置的模拟响应逻辑，支持快速搭建协议测试环境。

### 4.5 用户界面
- 主界面：输入区、规则编辑区、输出区、发送/接收配置区。
- 支持主题切换、搜索功能。

## 5. 非功能需求

- **跨平台**：兼容Windows、macOS、Linux。
- **性能**：解析时间 < 1秒 for 1KB数据。
- **可用性**：直观UI，支持中文界面。
- **安全性**：不存储敏感数据，本地运行。
- **可扩展性**：规则系统易于扩展。

## 6. 技术栈建议
- **框架**：Electron（跨平台桌面应用）。
- **前端**：React.js 或 Vue.js，用于UI。
- **后端**：Node.js，用于解析逻辑。
- **存储**：本地JSON文件存储规则。
- **其他**：使用Buffer处理16进制数据；使用dgram模块处理UDP发送和接收；实现各种解析算法如LongToIp、BCD、UTF8等。

## 7. 风险和假设
- **风险**：复杂UDP协议的解析准确性需测试；UDP发送/接收的网络权限和兼容性。
- **假设**：用户提供有效的16进制输入；UDP协议基于标准RFC；用户有网络访问权限。
- **依赖**：依赖Electron的跨平台兼容性；Node.js dgram模块。

## 8. 附录
- 版本历史：初稿于2025-11-27；更新于2025-11-27，添加HexDump支持、生成码流、UDP发送/接收功能；进一步更新于2025-11-27，增强规则系统支持枚举选择、解析算法和条件字段解析；再次更新于2025-11-27，添加UDP接收后的自动响应机制以及知名协议(STUN, SIP等)的自动解析和模拟响应。