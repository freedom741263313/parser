# UDP协议解析器 - 原型交互文档 (Prototype Design)

## 1. 设计概述

本文档描述了"跨平台桌面UDP协议解析器"的用户界面(UI)设计和交互流程(UX)。基于PRD v1.8文档，旨在提供直观、高效的操作体验。

### 1.1 核心设计理念
- **左侧导航，右侧内容**：采用经典的侧边栏导航布局，确保各功能模块切换便捷。
- **可折叠导航**：侧边栏支持折叠，最大化工作区域。
- **分屏视图**：在解析和调试界面，采用左右分屏，左侧为输入，右侧为解析结果，便于对照。
- **全中文界面**：所有界面元素、提示信息均为中文。
- **个性化主题**：提供多种主题，满足不同用户的视觉偏好。

## 2. 界面导航结构

应用主要分为四个主功能模块，通过左侧侧边栏图标/文字进行切换：

1.  **解析器 (Parser)**：核心功能，静态数据的输入、解析和码流生成。
2.  **UDP调试 (UDP Debugger)**：动态功能，UDP发送、接收、监听和自动响应。
3.  **规则管理 (Rule Manager)**：协议规则的增删改查。
4.  **枚举管理 (Enum Manager)**：枚举字典的维护。

侧边栏底部提供 **[<]** 折叠按钮。

### 2.1 布局结构
- **窗口**：标准桌面窗口，默认大小 1200x800，支持缩放。**隐藏系统顶部菜单栏**。
- **侧边栏 (Sidebar)**：位于左侧，宽度固定（可折叠），深色背景。
    - **顶部**：应用Logo和名称。
    - **中部**：导航菜单。
    - **底部**：主题切换器 + 折叠按钮 + 版本信息。

---

## 3. 界面详细设计

### 3.1 解析器 (Parser) 界面

**布局**：
- **顶部工具栏**：
    - **协议选择器**：下拉框，选择当前使用的协议规则。
        - **内置/演示**：例如 `演示协议`, `STUN (RFC 5389)`, `SIP (RFC 3261)`。
        - **自定义规则**：列出用户创建的规则。
    - **加载示例**：文字按钮，点击后触发加载或生成示例的流程。

- **主内容区**（左右分屏，高度对齐）：
    - **左侧（输入区）**：
        - **标题栏**：
            - 标题："输入"
            - **工具栏按钮**：
                - `[复制]`：图标按钮，复制内容到剪贴板。
                - `[保存]`：图标按钮（仅自定义规则显示），弹出确认框将内容保存为该规则的默认示例。
                - `[格式化]`：文字/图标按钮，手动格式化Hex。
                - `[清空]`：图标按钮，清空内容。
        - **文本框**：
            - 多行文本框，支持HexDump格式输入。
            - 占位符提示中文。
        - **底部按钮**：`[解析]`（带图标）。
        - **错误提示**：显示在文本框下方。

    - **右侧（结果区）**：
        - **标题栏**：
            - 标题："解析结果"（与输入区标题栏高度一致）。
        - **内容展示**：
            - **表格/树状视图**：显示解析后的结构化数据。
            - 显示 `[字段名]`, `[原始Hex]`, `[解析值/枚举含义]`。
            - 支持展开/折叠嵌套结构。
            - 空状态提示："等待解析..."。

**交互流程 - 样本生成**：
1.  用户点击`[加载示例]`。
2.  如果该规则无预设样本，或用户选择"生成新示例"，弹出**样本生成弹窗**。
3.  **弹窗内容**：
    - 根据规则字段动态生成的表单。
    - **数字字段**：聚焦时自动全选默认值（0），方便直接输入。
    - **枚举字段**：显示为下拉框，列出所有选项（如 `Success (0x01)`），用户直接选择。
    - **数组字段**：提示用户使用分号（;）分隔多个元素。
4.  点击`[生成并保存]`。
5.  系统生成Hex字符串，填入输入框，并自动保存为该规则的示例。

### 3.2 UDP调试 (UDP Debugger) 界面

**布局**：
- **左侧栏（本地监听与日志）**：
    - **连接配置**：
        - 本地监听端口输入框。
        - 按钮：`[启动] / [停止]`。
        - 自动回复开关。
    - **消息列表**：
        - **列表项**：
            - `[时间] [方向(发送/接收)] [地址] [数据(部分Hex) + 复制按钮]`。
            - **交互**：支持文本选中。支持点击行展开详情。
            - **样式**：发送消息显示为绿色，接收消息显示为蓝色。
        - **展开详情**：
            - **原始码流**：显示格式化后的Hex数据，每行16个字节，等宽字体，方便阅读。
            - **解析结果**（若匹配）：
                - 显示协议名称标签。
                - 表格显示解析字段：`[字段名] [值] [含义/格式化]`。
                - 若无法匹配，提示"未能匹配到已知协议规则进行解析"。

- **右侧栏（功能区）**：
    - **顶部页签**：`[调试器] | [模版管理] | [自动回复]`。
    
    - **页签1：调试器 (Debugger)**
        - **发送配置**：
            - 目标IP、端口输入框。
        - **内容输入**：
            - 协议选择器。
            - 16进制输入框。
            - `[发送]`按钮。

    - **页签2：模版管理 (Template Manager)**
        - **模版列表**：
            - 左侧显示已保存的模版列表。
            - 支持`[新建]`, `[删除]`, `[重命名]`。
        - **编辑区域**：
            - **双列网格表单**：根据所选协议规则动态生成。
            - 每个字段占用一列，两列一行，紧凑布局。
            - 底部`[保存]`按钮。

    - **页签3：自动回复 (Auto Reply)**
        - **规则列表**：显示已配置的自动回复规则。
        - **添加/编辑规则**：
            - **触发条件**：选择协议 -> 选择字段 -> 输入匹配值（Hex）。
            - **响应动作**：支持添加多个动作。
                - 每个动作：选择响应模版 + 设置延迟时间(ms)。
            - `[保存]`按钮。

### 3.3 侧边栏 (Sidebar)

**状态**：
- **展开状态**：显示完整Logo、导航菜单项（图标+文字）、主题切换面板、折叠按钮、版本号。
- **折叠状态**：仅显示图标、主题切换按钮（循环切换）、折叠按钮。

**主题切换器**：
- **位置**：位于导航菜单下方，折叠按钮上方。
- **展开时**：
    - 标题："主题切换"。
    - 按钮组：`[明亮] [暗黑] [护眼] [海洋]`。
    - 每个按钮包含图标和文字。
    - 当前选中的主题高亮显示。
- **折叠时**：
    - 显示单一按钮（调色板图标）。
    - 点击按钮循环切换下一个主题。
    - Tooltip提示"切换主题"。

## 4. 非功能需求

- **跨平台**：兼容Windows、macOS、Linux。
- **性能**：解析时间 < 1秒 for 1KB数据。
- **可用性**：直观UI，支持中文界面，便捷的样本生成与管理体验。
- **安全性**：不存储敏感数据，本地运行。
- **可扩展性**：规则系统易于扩展。

## 5. 技术栈建议
- **框架**：Electron（跨平台桌面应用）。
- **前端**：React.js 或 Vue.js，用于UI。
- **后端**：Node.js，用于解析逻辑。
- **存储**：本地JSON文件存储规则。
- **其他**：使用Buffer处理16进制数据；使用dgram模块处理UDP发送和接收；实现各种解析算法如LongToIp、BCD、UTF8等。
